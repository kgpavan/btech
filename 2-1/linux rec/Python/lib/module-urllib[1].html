<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<title>11.2 urllib -- Open an arbitrary resource by URL</title>
<META NAME="description" CONTENT="11.2 urllib -- Open an arbitrary resource by URL">
<META NAME="keywords" CONTENT="lib">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<link rel="STYLESHEET" href="lib.css">
<LINK REL="next" href="module-httplib.html">
<LINK REL="previous" href="module-cgi.html">
<LINK REL="up" href="internet.html">
<LINK REL="next" href="urlopener-objs.html">
</head>
<body bgcolor="#ffffff">
<div class='navigation'>
<table align='center' width='100%' cellpadding='0' cellspacing='2'>
<tr>
<td><A href="urlopener-objs.html"><img width=32 height=32 align=bottom border=0 alt="next"
 src="../icons/next.gif"></A></td>
<td><A href="internet.html"><img width=32 height=32 align=bottom border=0 alt="up"
 src="../icons/up.gif"></A></td>
<td><A HREF="node213.html"><img width=32 height=32 align=bottom border=0 alt="previous"
 src="../icons/previous.gif"></A></td>
<td align='center' bgcolor='#99CCFF' width='100%'>
 <b class=title>Python Library Reference</b></td>
<td><A href="contents.html"><img width=32 height=32 align=bottom border=0 alt="contents"
 src="../icons/contents.gif"></A></td>
<td><a
 href='modindex.html'><img width=32 height=32 align=bottom border=0 alt="modules"
 src="../icons/modules.gif"></a></td>
<td><A href="genindex.html"><img width=32 height=32 align=bottom border=0 alt="index"
 src="../icons/index.gif"></A></td>
</tr></table><b class='navlabel'>Next:</b> <span class='sectref'><A href="urlopener-objs.html">11.2.1 URLopener Objects</A></span>
<b class='navlabel'>Up:</b> <span class='sectref'><A href="internet.html">11. Internet Protocols and</A></span>
<b class='navlabel'>Previous:</b> <span class='sectref'><A HREF="node213.html">11.1.9 Common problems and</A></span>
<br><hr></div>
<!--End of Navigation Panel-->

<H1><A NAME="SECTION0013200000000000000000">
11.2 <tt class="module">urllib</tt> --
         Open an arbitrary resource by URL</A>
</H1>

<P>


<P>
<a name='l2h-1694'></a>

<P>
This module provides a high-level interface for fetching data across
the World-Wide Web.  In particular, the <tt class="function">urlopen()</tt> function
is similar to the built-in function <tt class="function">open()</tt>, but accepts
Universal Resource Locators (URLs) instead of filenames.  Some
restrictions apply -- it can only open URLs for reading, and no seek
operations are available.

<P>
It defines the following public functions:

<P>
<dl><dt><b><a name='l2h-1684'><tt class='function'>urlopen</tt></a></b> (<var>url</var><big>[</big><var>, data</var><big>]</big>)
<dd>
Open a network object denoted by a URL for reading.  If the URL does
not have a scheme identifier, or if it has <font class="file" face="sans-serif">file:</font> as its scheme
identifier, this opens a local file; otherwise it opens a socket to a
server somewhere on the network.  If the connection cannot be made, or
if the server returns an error code, the <tt class="exception">IOError</tt> exception
is raised.  If all went well, a file-like object is returned.  This
supports the following methods: <tt class="method">read()</tt>, <tt class="method">readline()</tt>,
<tt class="method">readlines()</tt>, <tt class="method">fileno()</tt>, <tt class="method">close()</tt>,
<tt class="method">info()</tt> and <tt class="method">geturl()</tt>.

<P>
Except for the <tt class="method">info()</tt> and <tt class="method">geturl()</tt> methods,
these methods have the same interface as for
file objects -- see section <A href="typesother.html#bltin-file-objects">2.1.7</A> in this
manual.  (It is not a built-in file object, however, so it can't be
used at those few places where a true built-in file object is
required.)

<P>
The <tt class="method">info()</tt> method returns an instance of the class
<tt class="class">mimetools.Message</tt> containing meta-information associated
with the URL.  When the method is HTTP, these headers are those
returned by the server at the head of the retrieved HTML page
(including Content-Length and Content-Type).  When the method is FTP,
a Content-Length header will be present if (as is now usual) the
server passed back a file length in response to the FTP retrieval
request.  When the method is local-file, returned headers will include
a Date representing the file's last-modified time, a Content-Length
giving file size, and a Content-Type containing a guess at the file's
type. See also the description of the
<tt class='module'><a href='module-mimetools.html'>mimetools</a></tt><a name='l2h-1695'></a> module.

<P>
The <tt class="method">geturl()</tt> method returns the real URL of the page.  In
some cases, the HTTP server redirects a client to another URL.  The
<tt class="function">urlopen()</tt> function handles this transparently, but in some
cases the caller needs to know which URL the client was redirected
to.  The <tt class="method">geturl()</tt> method can be used to get at this
redirected URL.

<P>
If the <var>url</var> uses the <font class="file" face="sans-serif">http:</font> scheme identifier, the optional
<var>data</var> argument may be given to specify a <code>POST</code> request
(normally the request type is <code>GET</code>).  The <var>data</var> argument
must in standard <font class="file" face="sans-serif">application/x-www-form-urlencoded</font> format;
see the <tt class="function">urlencode()</tt> function below.

<P>
The <tt class="function">urlopen()</tt> function works transparently with proxies.
In a Unix or Windows environment, set the <span class='envvar'><a name='l2h-1696'>$http_proxy</a></span>,
<span class='envvar'><a name='l2h-1697'>$ftp_proxy</a></span> or <span class='envvar'><a name='l2h-1698'>$gopher_proxy</a></span> environment variables to a
URL that identifies the proxy server before starting the Python
interpreter.  For example (the "<tt class="character">%</tt>" is the command prompt):

<P>
<dl><dd><pre class="verbatim">
% http_proxy="http://www.someproxy.com:3128"
% export http_proxy
% python
...
</pre></dl>

<P>
In a Macintosh environment, <tt class="function">urlopen()</tt> will retrieve proxy
information from Internet<a name='l2h-1699'></a> Config.

<P>
The <tt class="function">urlopen()</tt> function works transparently with proxies.
In a Unix or Windows environment, set the <span class='envvar'><a name='l2h-1700'>$http_proxy</a></span>,
<span class='envvar'><a name='l2h-1701'>$ftp_proxy</a></span> or <span class='envvar'><a name='l2h-1702'>$gopher_proxy</a></span> environment variables to a
URL that identifies the proxy server before starting the Python
interpreter, e.g.:

<P>
<dl><dd><pre class="verbatim">
% http_proxy="http://www.someproxy.com:3128"
% export http_proxy
% python
...
</pre></dl>

<P>
In a Macintosh environment, <tt class="function">urlopen()</tt> will retrieve proxy
information from Internet Config.
</dl>

<P>
<dl><dt><b><a name='l2h-1685'><tt class='function'>urlretrieve</tt></a></b> (<var>url</var><big>[</big><var>, filename</var><big>[</big><var>, hook</var><big>]</big><big>]</big>)
<dd>
Copy a network object denoted by a URL to a local file, if necessary.
If the URL points to a local file, or a valid cached copy of the
object exists, the object is not copied.  Return a tuple
<code>(<var>filename</var>, <var>headers</var>)</code> where <var>filename</var> is the
local file name under which the object can be found, and <var>headers</var>
is either <code>None</code> (for a local object) or whatever the
<tt class="method">info()</tt> method of the object returned by <tt class="function">urlopen()</tt>
returned (for a remote object, possibly cached).  Exceptions are the
same as for <tt class="function">urlopen()</tt>.

<P>
The second argument, if present, specifies the file location to copy
to (if absent, the location will be a tempfile with a generated name).
The third argument, if present, is a hook function that will be called
once on establishment of the network connection and once after each
block read thereafter.  The hook will be passed three arguments; a
count of blocks transferred so far, a block size in bytes, and the
total size of the file.  The third argument may be <code>-1</code> on older
FTP servers which do not return a file size in response to a retrieval 
request.
</dl>

<P>
<dl><dt><b><a name='l2h-1686'><tt class='function'>urlcleanup</tt></a></b> ()
<dd>
Clear the cache that may have been built up by previous calls to
<tt class="function">urlretrieve()</tt>.
</dl>

<P>
<dl><dt><b><a name='l2h-1687'><tt class='function'>quote</tt></a></b> (<var>string</var><big>[</big><var>, safe</var><big>]</big>)
<dd>
Replace special characters in <var>string</var> using the "<tt class="samp">%xx</tt>" escape.
Letters, digits, and the characters "<tt class="character">_,.-</tt>" are never quoted.
The optional <var>safe</var> parameter specifies additional characters
that should not be quoted -- its default value is <code>'/'</code>.

<P>
Example: <code>quote('/connolly/')</code> yields <code>'/%7econnolly/'</code>.
</dl>

<P>
<dl><dt><b><a name='l2h-1688'><tt class='function'>quote_plus</tt></a></b> (<var>string</var><big>[</big><var>, safe</var><big>]</big>)
<dd>
Like <tt class="function">quote()</tt>, but also replaces spaces by plus signs, as
required for quoting HTML form values.  Plus signs in the original
string are escaped unless they are included in <var>safe</var>.
</dl>

<P>
<dl><dt><b><a name='l2h-1689'><tt class='function'>unquote</tt></a></b> (<var>string</var>)
<dd>
Replace "<tt class="samp">%xx</tt>" escapes by their single-character equivalent.

<P>
Example: <code>unquote('/%7Econnolly/')</code> yields <code>'/connolly/'</code>.
</dl>

<P>
<dl><dt><b><a name='l2h-1690'><tt class='function'>unquote_plus</tt></a></b> (<var>string</var>)
<dd>
Like <tt class="function">unquote()</tt>, but also replaces plus signs by spaces, as
required for unquoting HTML form values.
</dl>

<P>
<dl><dt><b><a name='l2h-1691'><tt class='function'>urlencode</tt></a></b> (<var>dict</var>)
<dd>
Convert a dictionary to a ``url-encoded'' string, suitable to pass to
<tt class="function">urlopen()</tt> above as the optional <var>data</var> argument.  This
is useful to pass a dictionary of form fields to a <code>POST</code>request.  The resulting string is a series of
<code><var>key</var>=<var>value</var></code> pairs separated by "<tt class="character">&amp;</tt>"
characters, where both <var>key</var> and <var>value</var> are quoted using
<tt class="function">quote_plus()</tt> above.
</dl>

<P>
The public functions <tt class="function">urlopen()</tt> and <tt class="function">urlretrieve()</tt>
create an instance of the <tt class="class">FancyURLopener</tt> class and use it to perform
their requested actions.  To override this functionality, programmers can
create a subclass of <tt class="class">URLopener</tt> or <tt class="class">FancyURLopener</tt>, then
assign that class to the <var>urllib._urlopener</var> variable before calling the
desired function.  For example, applications may want to specify a different
<code>user-agent</code> header than <tt class="class">URLopener</tt> defines.  This can be
accomplished with the following code:

<P>
<dl><dd><pre class="verbatim">
class AppURLopener(urllib.FancyURLopener):
    def __init__(self, *args):
        apply(urllib.FancyURLopener.__init__, (self,) + args)
        self.version = "App/1.7"

urllib._urlopener = AppURLopener
</pre></dl>

<P>
<dl><dt><b><a name='l2h-1692'><tt class='class'>URLopener</tt></a></b> (<big>[</big><var>proxies</var><big>[</big><var>, **x509</var><big>]</big><big>]</big>)
<dd>
Base class for opening and reading URLs.  Unless you need to support
opening objects using schemes other than <font class="file" face="sans-serif">http:</font>, <font class="file" face="sans-serif">ftp:</font>,
<font class="file" face="sans-serif">gopher:</font> or <font class="file" face="sans-serif">file:</font>, you probably want to use
<tt class="class">FancyURLopener</tt>.

<P>
By default, the <tt class="class">URLopener</tt> class sends a
<code>user-agent</code> header of "<tt class="samp">urllib/<var>VVV</var></tt>", where
<var>VVV</var> is the <tt class="module">urllib</tt> version number.  Applications can
define their own <code>user-agent</code> header by subclassing
<tt class="class">URLopener</tt> or <tt class="class">FancyURLopener</tt> and setting the instance
attribute <var>version</var> to an appropriate string value before the
<tt class="method">open()</tt> method is called.

<P>
Additional keyword parameters, collected in <var>x509</var>, are used for
authentication with the <font class="file" face="sans-serif">https:</font> scheme.  The keywords
<var>key_file</var> and <var>cert_file</var> are supported; both are needed to
actually retrieve a resource at an <font class="file" face="sans-serif">https:</font> URL.
</dl>

<P>
<dl><dt><b><a name='l2h-1693'><tt class='class'>FancyURLopener</tt></a></b> (<var>...</var>)
<dd>
<tt class="class">FancyURLopener</tt> subclasses <tt class="class">URLopener</tt> providing default
handling for the following HTTP response codes: 301, 302 or 401.  For
301 and 302 response codes, the <code>location</code> header is used to
fetch the actual URL.  For 401 response codes (authentication
required), basic HTTP authentication is performed.

<P>
The parameters to the constructor are the same as those for
<tt class="class">URLopener</tt>.
</dl>

<P>
Restrictions:

<P>

<UL><LI>Currently, only the following protocols are supported: HTTP, (versions
0.9 and 1.0), Gopher (but not Gopher-+), FTP, and local files.
<a name='l2h-1703'></a>

<P>

<LI>The caching feature of <tt class="function">urlretrieve()</tt> has been disabled
until I find the time to hack proper processing of Expiration time
headers.

<P>

<LI>There should be a function to query whether a particular URL is in
the cache.

<P>

<LI>For backward compatibility, if a URL appears to point to a local file
but the file can't be opened, the URL is re-interpreted using the FTP
protocol.  This can sometimes cause confusing error messages.

<P>

<LI>The <tt class="function">urlopen()</tt> and <tt class="function">urlretrieve()</tt> functions can
cause arbitrarily long delays while waiting for a network connection
to be set up.  This means that it is difficult to build an interactive
web client using these functions without using threads.

<P>

<LI>The data returned by <tt class="function">urlopen()</tt> or <tt class="function">urlretrieve()</tt>
is the raw data returned by the server.  This may be binary data
(e.g. an image), plain text or (for example) HTML<a name='l2h-1704'></a>.  The
HTTP<a name='l2h-1705'></a> protocol provides type information in the
reply header, which can be inspected by looking at the
<code>content-type</code> header.  For the Gopher<a name='l2h-1706'></a>
protocol, type information is encoded in the URL; there is currently
no easy way to extract it.  If the returned data is HTML, you can use
the module <tt class='module'><a href='module-htmllib.html'>htmllib</a></tt><a name='l2h-1707'></a> to parse it.

<P>

<LI>Although the <tt class="module">urllib</tt> module contains (undocumented) routines
to parse and unparse URL strings, the recommended interface for URL
manipulation is in module <tt class='module'><a href='module-urlparse.html'>urlparse</a></tt><a name='l2h-1708'></a>.

<P>

</UL>

<P>

<p><hr>
<!--Table of Child-Links-->


<UL>
<LI><A NAME="tex2html3231"
 href="urlopener-objs.html">11.2.1 URLopener Objects </A>
<LI><A NAME="tex2html3232"
 href="Urllib_Examples.html">11.2.2 Examples</A>
</UL>
<!--End of Table of Child-Links-->
<p>
<div class='navigation'><hr><table align='center' width='100%' cellpadding='0' cellspacing='2'>
<tr>
<td><A href="urlopener-objs.html"><img width=32 height=32 align=bottom border=0 alt="next"
 src="../icons/next.gif"></A></td>
<td><A href="internet.html"><img width=32 height=32 align=bottom border=0 alt="up"
 src="../icons/up.gif"></A></td>
<td><A HREF="node213.html"><img width=32 height=32 align=bottom border=0 alt="previous"
 src="../icons/previous.gif"></A></td>
<td align='center' bgcolor='#99CCFF' width='100%'>
 <b class=title>Python Library Reference</b></td>
<td><A href="contents.html"><img width=32 height=32 align=bottom border=0 alt="contents"
 src="../icons/contents.gif"></A></td>
<td><a
 href='modindex.html'><img width=32 height=32 align=bottom border=0 alt="modules"
 src="../icons/modules.gif"></a></td>
<td><A href="genindex.html"><img width=32 height=32 align=bottom border=0 alt="index"
 src="../icons/index.gif"></A></td>
</tr></table><b class='navlabel'>Next:</b> <span class='sectref'><A href="urlopener-objs.html">11.2.1 URLopener Objects</A></span>
<b class='navlabel'>Up:</b> <span class='sectref'><A href="internet.html">11. Internet Protocols and</A></span>
<b class='navlabel'>Previous:</b> <span class='sectref'><A HREF="node213.html">11.1.9 Common problems and</A></span>
</div>
<!--End of Navigation Panel-->
<ADDRESS>
<hr>Send comments on this document to <a href="mailto:python-docs@python.org">python-docs@python.org</a>.
</ADDRESS>
</BODY>
</HTML>
